@startuml
!define AWSPuml https://raw.githubusercontent.com/awslabs/aws-icons-for-plantuml/v18.0/dist
!include AWSPuml/AWSCommon.puml
!include AWSPuml/ApplicationIntegration/APIGateway.puml
!include AWSPuml/Compute/EC2.puml
!include AWSPuml/Storage/SimpleStorageService.puml

' Layout configuration
left to right direction
skinparam defaultTextAlignment center
skinparam rectangleBorderThickness 2
skinparam rectangleFontStyle bold

' Styling for visual hierarchy
skinparam rectangle {
    BackgroundColor<<boundary>> #FFE4B5
    BorderColor<<boundary>> #FF8C00
    BorderThickness<<boundary>> 3
}

skinparam rectangle {
    BackgroundColor<<execution>> #E6F3FF
    BorderColor<<execution>> #4682B4
    BorderThickness<<execution>> 2
}

' Client Layer
rectangle "==Client\n" as ClientLayer #F0F8FF {
    component "**Noesis Noema**\n(Client-side Router)\n\n• Routing\n• Policy Decision\n• Human Interaction" as noemaApp
}

' Invocation Boundary - visually emphasized
rectangle "==Invocation Boundary\n" as BoundaryLayer <<boundary>> {
    APIGateway(api, "noema-agent API", "Responsibility Border")
}

' Execution Layer - emphasized
rectangle "==Execution Layer\n" as ExecutionLayer <<execution>> {
    EC2(exec, "noema-agent", "(Dockerized Executor)\n\nConstrained Execution Only\n(No Decision Making)")
}

' Knowledge Layer
rectangle "==Knowledge\n" as KnowledgeLayer #FFFAF0 {
    SimpleStorageService(ragstore, "RAGpack Store", "(Model-agnostic Knowledge)\n\nNo Behavior")
}

' Relationships with clear labels
ClientLayer -right->> BoundaryLayer : **request**\n//policy-routed invocation//
BoundaryLayer -right->> ExecutionLayer : **constrained**\n//execution request//
ExecutionLayer -right->> KnowledgeLayer : **retrieve**\n//reference//

' Title and notes
title RAGfish / Noema Architecture\nArchitecture Constitution: AI is not the Subject

note bottom of ClientLayer
  **Responsibility:**
  • Route requests
  • Make policy decisions
  • Handle human interaction
end note

note bottom of BoundaryLayer
  **Boundary:**
  Separates decision-making
  from execution
end note

note bottom of ExecutionLayer
  **Responsibility:**
  • Execute constrained tasks
  • No decision authority
  • Stateless operation
end note

note bottom of KnowledgeLayer
  **Responsibility:**
  • Store knowledge
  • Provide references
  • No autonomous behavior
end note

@enduml